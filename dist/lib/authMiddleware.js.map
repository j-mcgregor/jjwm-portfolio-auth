{"version":3,"sources":["../../src/lib/authMiddleware.js"],"names":["req","res","next","cookies","COOKIE_1","COOKIE_2","errors","cookie1","cookie2","status","json","token","passport","authenticate","decoded","jwt","verify","config","secret","user","err","Error"],"mappings":";;;;;;;AACA;;AACA;;AACA;;AACA;;;;AAJA;eAMe,CAACA,GAAD,EAAMC,GAAN,EAAWC,IAAX,KAAoB;AACjC,QAAM;AAAEC,IAAAA,OAAO,GAAG;AAAZ,MAAmBH,GAAzB;;AAEA,MAAI,CAACG,OAAO,CAACC,QAAT,IAAqB,CAACD,OAAO,CAACE,QAAlC,EAA4C;AAC1C,UAAMC,MAAM,GAAG,EAAf;AACA,QAAI,CAACH,OAAO,CAACC,QAAb,EAAuBE,MAAM,CAACC,OAAP,GAAiB,kBAAjB;AACvB,QAAI,CAACJ,OAAO,CAACE,QAAb,EAAuBC,MAAM,CAACE,OAAP,GAAiB,kBAAjB;AACvBP,IAAAA,GAAG,CAACQ,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AAAEJ,MAAAA;AAAF,KAArB;AACD,GALD,MAKO;AACL,UAAMK,KAAK,GAAG,4BAAcR,OAAd,CAAd;;AAEAS,sBAASC,YAAT,CAAsB,KAAtB,EAA6B,MAAM;AACjC,UAAI;AACF,cAAMC,OAAO,GAAGC,sBAAIC,MAAJ,CAAWL,KAAX,EAAkBM,gBAAOC,MAAzB,CAAhB;;AACAlB,QAAAA,GAAG,CAACmB,IAAJ,GAAWL,OAAX;AACAZ,QAAAA,IAAI;AACL,OAJD,CAIE,OAAOI,MAAP,EAAe;AACf,cAAMc,GAAG,GAAG,IAAIC,KAAJ,CAAUf,MAAV,CAAZ;AACAL,QAAAA,GAAG,CAACQ,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AAAEU,UAAAA;AAAF,SAArB;AACD;AACF,KATD,EASGpB,GATH,EASQC,GATR,EASaC,IATb;AAUD;AACF,C","sourcesContent":["/* eslint-disable no-prototype-builtins */\nimport passport from 'passport';\nimport jwt from 'jsonwebtoken';\nimport assembleToken from './assembleToken';\nimport config from '../../config';\n\nexport default (req, res, next) => {\n  const { cookies = {} } = req;\n\n  if (!cookies.COOKIE_1 || !cookies.COOKIE_2) {\n    const errors = {};\n    if (!cookies.COOKIE_1) errors.cookie1 = 'COOKIE 1 missing';\n    if (!cookies.COOKIE_2) errors.cookie2 = 'COOKIE 2 missing';\n    res.status(400).json({ errors });\n  } else {\n    const token = assembleToken(cookies);\n\n    passport.authenticate('jwt', () => {\n      try {\n        const decoded = jwt.verify(token, config.secret);\n        req.user = decoded;\n        next();\n      } catch (errors) {\n        const err = new Error(errors);\n        res.status(400).json({ err });\n      }\n    })(req, res, next);\n  }\n};\n"],"file":"authMiddleware.js"}